\renewcommand{\thesection}{\arabic{chapter}.\arabic{section}}

\chapter*{Code Annex}
\addcontentsline{toc}{chapter}{Code Annex}
\label{chap:code}
\cleardoublepage
\doublespacing

\section*{Autocorrelation lengthscale}

This first bit of code builds the autocorrelation lengthscales introduced in chapter 2.\\

It takes data from Meteofrance, that comes as files containing a row per observation, each row containing the timestamp of the observation, as well as the code of the station, and the observation itself, to which was added the latitude and longitude of the current station. For a given year, only data pertaining to this year is kept in memory, to avoid running out of RAM. \\

Once this first step is done, and for every timestamp, all pairs of stations are taken, and the difference of value in the observation is taken, as well as the distance between the stations. \\

Once this treated data is generated, an exponential is fitted, and its coefficient is saved as the autocorrelation lengthscale for this given variable, and this given timestamp. The code to generate a graph of the cloud of points and the fitted function is also included.\\

\lstset{language=Matlab,%
    %basicstyle=\color{red},
    breaklines=true,%
    morekeywords={matlab2tikz},
    keywordstyle=\color{blue},%
    morekeywords=[2]{1}, keywordstyle=[2]{\color{black}},
    identifierstyle=\color{black},%
    stringstyle=\color{mylilas},
    commentstyle=\color{mygreen},%
    showstringspaces=false,%without this there will be a symbol in the places where there is a space
    numbers=left,%
    numberstyle={\tiny \color{black}},% size of the numbers
    numbersep=9pt, % this defines how far the numbers are from the text
    emph=[1]{for,end,break},emphstyle=[1]\color{red}, %some words to emphasise
    %emph=[2]{word1,word2}, emphstyle=[2]{style},    
}
\lstinputlisting[language=Matlab,basicstyle=\tiny]{lautocorclean.m}

\newpage

\section*{Regressions}

\lstdefinelanguage{Stata}{
    % Left for users to add missing commands,
    % with possibility of choosing different style.
    morekeywords=,
    % Popular add-on commands
    morekeywords=[2]{cntrade, chinafin, 
                     wbopendata, spmap,
    },
    % System commands
    morekeywords=[3]{regress, summarize, 
                     display,
    },
    % Keywords
    morekeywords=[4]{forvalues, if, foreach, set},
    % Built-in functions
    morekeywords=[5]{rnormal, runiform},
    morecomment=[l]{//},
    % morecomment=[l]{*},  // `*` maybe used as multiply operator. So use `//` as line comment.
    morecomment=[s]{/*}{*/},
    % morecomment=[s]{,}{//},
    % The following is used by macros, like `lags'.
    morecomment=[n][keywordstyle9]{`}{'},
    morestring=[b]",
    sensitive=true,
}

\lstdefinestyle{numbers}{
    numbers=left, 
    stepnumber=1, 
    numberstyle=\tiny\emptyaccsupp,
    xleftmargin=2em,
}

\lstdefinestyle{nonumbers}{
    numbers=none,
}

\lstdefinestyle{stata-plain}{
    % comment slanted and keywords bolded.
    language=Stata,
    basicstyle=\setmonofont{Consolas}\footnotesize\ttfamily,
}

\lstdefinestyle{stata-editor}{
    language=Stata,
    % size of the fonts for the code
    basicstyle=\setmonofont{Consolas}\footnotesize\ttfamily,  
    % Color settings to match do-file editor style
    % Commands that are not included in the defination
    keywordstyle={\color{NavyBlue}},  
    % Popular add-on commands
    keywordstyle=[2]{\color{NavyBlue}},
    % System commands
    keywordstyle=[3]{\color{NavyBlue}},
    % Keywords
    keywordstyle=[4]{\color{NavyBlue}},
    % Built-in functions like rnormal
    keywordstyle=[5]{\color{Blue}},
    % Used by macros, i.e. `lags'  
    keywordstyle=[9]{\color{TealBlue}},
    stringstyle=\color{Maroon},
    commentstyle=\color{OliveGreen},
}


\lstset{
    language=Stata,
    style=stata-plain,
    % style=stata-editor,
    style=numbers,
    showstringspaces=false,
    breaklines,
    frame=single,
    % To add missing commands
    % morekeywords={xtreg, xtunitroot},
}

The next bit of code is the general do file for the regressions of chapter 3. \\

\lstinputlisting[language=Stata,basicstyle=\tiny]{110_FINAL.do}

\newpage
Next is the script named \verb|107_Eqn4demand.do| and called in the general file.\\

\lstinputlisting[language=Stata,basicstyle=\tiny]{107_Eqn4demand.do}
 
 \newpage
Next is the script named \verb|107_kernelbucketreg.do| and called in the general file.\\

\lstinputlisting[language=Stata,basicstyle=\tiny]{107_kernelbucketreg.do}

\newpage
Next is the script named \verb|107_PrepkernelPLUdata.do| and called in the general file.\\

\lstinputlisting[language=Stata,basicstyle=\tiny]{107_PrepkernelPLUdata.do}

\newpage
Next is the script named \verb|107_BootstrapKernel2702.do| and called in the general file.\\

\lstinputlisting[language=Stata,basicstyle=\tiny]{107_BootstrapKernel2702.do} 
 